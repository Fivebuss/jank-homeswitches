// Half-broken HomeWorldName-based homeswitch
// In theory this approach should be much, much better than renaming and moving things around. However, it is not without its MAJOR downsides, alongside the usual problems of homeswitches
// Set inside KSS2Settings.cfg 'homeSwitch = Alva' to use, set it to False to remove

// !!!!!!!!!! VERY IMPORTANT
// Regarding the camera displacement bug: It seems that a save and unsave inside an active game session is required. 
// If we do not do this, (Ex: Load into tracking station then out again) theres a 50/50 chance severe problems will occur. Its basically gambling
// This issue is *not* fixable by me, without writing a .dll mod. I COULD maybe do that in the far future. Or kopernicus could fix it
// !!!!!!!!!!

@Kopernicus_config:HAS[@KSS2_Settings:HAS[#homeSwitch[Alva]]]:BEFORE[KSS2]
{
    %HomeWorldName = Alva // Much better than PostOrbit
}

// We are disabling ondemand to fix the flashing orbit lines bug, and because its a switched homeworld, to attempt to curb trackingStation issues
@Kopernicus:HAS[@KSS2_Settings:HAS[#homeSwitch[Alva]]]:AFTER[KSS2]
{
    @Body[Alva]
    {
        @ScaledVersion
        {
            @Material
            {
                texture = KSS2/SystemNovaKirbani/PluginData/Alva_Color.dds
                normals = KSS2/SystemNovaKirbani/PluginData/Alva_Normal.dds
            }
            !OnDemand {}
        }
    }
}

@Kopernicus:HAS[@KSS2_Settings:HAS[#homeSwitch[Alva]]]:AFTER[KSS2]
{
    removeLaunchSites = Desert_Launch_Site,Desert_Airfield,Desert_GroundObjects,Woomerang_Launch_Site,Woomerang_GroundObjects,Island_Airfield 
    Body[Kerbin]
    {
        @PQS
        {
            !Mods[MapDecalTangent,KSC] {}
        }
        // Attempt to strip SpaceCenter node from kerbin
        !SpaceCenter {}
    }

    // Alva
    @Body[Alva]
    {
        @Properties
        {
            isHomeWorld = true // Help KSC scene bug
        }
        
        // Oh boy
        SpaceCenter
        {
            // Location options seem to be fine (?) by default 
            //latitude = 0
            //longitude = 43.7
            //decalLatitude = 0
            //decalLongitude = 43.7
            radius = 7500
            repositionRadiusOffset = 42.7
            repositionRadial = 157000,-1000,-574000 // Position
            reorientFinalAngle = 48            // Rotation aligned to nearby hill
            lodvisibleRangeMult = 6
            repositionToSphereSurface = False // Needs radius update
            repositionToSphereSurfaceAddHeight = False
            absoluteOffset = 0
            absolute = true

            // Desert sand color
            Material
            {
                grassColor = RGBA(214, 161, 98, 0.77)
            }
        }
    }
}

// Helps fix problems
@Kopernicus_config:HAS[@KSS2_Settings:HAS[#homeSwitch[Alva]]]:AFTER[KOPERNICUS]
{
    %useManualMemoryManagement = True 
}
